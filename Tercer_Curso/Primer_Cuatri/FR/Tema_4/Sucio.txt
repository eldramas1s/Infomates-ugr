
La manera de eliminar el hjombr en medio en Diffie-Hellman se resuelve autenticando al servidor cosa que se resuelve ya en TLS mediante el certificado digital.

Protocolos seguros
--------------------------
---------------------


PGP
---------------------------
Esun protocolo de aplicacion

Sea P el texto plano al que le generaremos un MD5(P)=R, es decir, el compendio; FD=KprivA(R) como firma digital.

Comprimir la firma digital junto al rexto plano (no sirve pa na, solo para mandar menos datos)

Ciframos la firma digital y el texto plano, es decir obtenemos C=IDEAk(Z) + KpubB dondek es una clave de  sesion que solo sirve para unmensaje.

Ademas el mensaje que mandamos lo codificamos con B64, es simplemente una codificacion y no un cifrado.

Todo esto es lo que s emanda a traves del canal y el receptor consigue C decodificando M y obtenemos la clave de sesion ademas de descifrar con la clave; en general hacemos el proceso inverso y comprobamos que sabiendo el texto plano en B que el resultado es correcto.
Tenemos confidencialidad, integridad, autenticacion porque hemos cifrado algo con la clave privada; pdría conseguir no repudio con el certificado digital usandolo.

TLS
---------------------------
A nivel de rtansporte
TLS y SSl tienden a ser lo mismo, uno es la implementacion de una empresa y otro es el que se ha estandarizado; las implementacione sno son compatibles.

En realidad noe s un protocolo sino un familia de protocolos, el ptimero que se usa es:
- Handshake protocol: negocia el algoritmo de cifrado, la funcion hash para integridad, autentica el servidor con certificado(el cliente no se autentica). El cliente genra claves de sesion aleatorias o usando Diffie-Hellman

Las claves de sesión son simplemente claves temporales

Una vez se ha hecho esto:
- Se usa SSl record protocol que se encarga de encapsular los protocolos y ofrece un canal seguro con privacidad, autenticación e integridad. Es un protocolo de registro(los mensajes enciados sobre ssl son los registros), es el que permite mandar las cosas.

Para comprobar la s cosas se usa el SSL alert protocol.

Chande Cipher Spec PRotocol sirve para notificar cambios en el cifrado.


EN este protocolo no hay problema de man-in-the-middle mediante el certificado digital; pues si no estuviera autenticado no se podría descifrar con la clave publica del emisor, es decir el mensaje esta cifrado con la clave privada del emisor que como esta autenticado con el certificado digital.

De normal, Diffie-Hellman no esta cifrado lueg aportando el cifrado con el certificado digital evitmos man in the middle.

Se usa para VPN

IPSec
---------

A nivel de red

Crea tuneles donde los datos van cifrados, pasan dos cosas:

- Los tuneles son unidireccionales, entonces solo puedo mandar en una direccion y si quiero mandar en otro sentido se debe crear otro tunel. Si este tunel esta cifrado tengo un túnel seguro.

La idea de tunel consiste en una consexion donde entra un paquete y sale el mismo sin ninguna modificación. Esto se consigue incluyendo un paquete dentro de otro , es decri tendriamos dos cabeceras IP y luego los datos.

A este proceso se le llama encapsulamiento y es necesario para hacer un tunel.

Se usa para VPN

Se usan tres procedimientos:

- Asociacion de seguridad: establecemos una clave secreta con Diffie-Helmann autenticando previamente con certificados digitals(si no se hace con esto puede haber fallos). 
Se identifica con la IP orrigne y un parametro de seguridad ccon 32 bits.
- GArantía de autenticacion e integridad -> Cabeceras de autenticacion.
- Garantía de autenticación e integridad y privacidad -> Encapsulado de seguridad de la carga.7


Independientemente de que se use 2 o 3 tiene dos modos de operación:
- Modo transporte: se establece un tinel entre dos extremos ya sea con seguridad o sin seguridad.
- Modo tubnel: consiste en delegar el tunel entre dos servidores que dan a redes locales luego los pc's se comunicaran por una red donde la información no esta cifrada. Con esto podemos comunicar una red sin tener que hacer muchisimos tuneles.


Un problema de IPSec es que establece la conexion antes de mandar cosa que rompe la filosofía de TCP/IP.


