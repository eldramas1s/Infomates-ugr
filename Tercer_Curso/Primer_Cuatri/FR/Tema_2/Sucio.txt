
    
   IP PRIVADAS
   --------------------------------------
    Nota: lo bueno de la smascaras es que podría hacerse direccion sin clase, donde la mascara podría ser cualqueir valor.

    La direccion 127.0.0.1 es la local loop luego si busco conectarme a la slocalhost obtendre la conexion con un servidor de mi propia maquina. Actualmente es cualquier direccion que se comience por 127.___x. La direccion local loop es propia de cada equipo aunque no disponga de tarjeta de red.

    El direccionamiento sin clase se basa en el uso de mascaras. EL reparto por clases de las redes ocasiona un desperdicio alucinante, siendo públicas son únicas en el mundo, de esta forma perdemos muchos casos.

    EN la realidad, el numero de unos de la mascara la caambio a la cantidad que interesa, por ejemplo usar una mascara mas ajustada no necesariamnete multiplo de 8. De esta manera tendre muchas mas redes con menos dispositivos pero los necesarios para evitar un gran desperdicio.

    La ultima direccion IP de cada red es la de difusion y la prumera la de red. El proceo es el mismo y la division sigue siendo de 8 bits por punto, luego no siempre empezara en la A.B.C.0 ni acabara en la A.B.C.255

    A lo que ahora hemos conseguido partiendo una red de tipo C (aunque puede ser de cualquier tipo) lo llamaremos tambien subred.

    Si hacemos le proceso inverso, es decir, le quitamos un bit a la mascara entonces duplicamos el numero de equipos opbteniendo así una superred, que graficamente se puede entender como juntar dos redes de tamaño original.

    Buscamos desperdidicar el minimo de direcciones luego merece mas la pena juntar dos de clase C  en lugar de una de clase B para perder menos.

    Ejercicio tipo:

    Nos dan un numero de equipos y tenemos que asignar la mejor red:
        · Equipos: 700
        · Numero de direccion de dipositivos: 702 (dir.difusion; dir. red)
        · Bits minimos necesarios: 10
        · 32-10 = 22 luego la mascara es /22 
        · Rango: [192.168.0.0/22-192.168.3.255]
                    ^ 
                    |
                    Direccion de red

    Aunque sean superredes se les suelen llamar tamben subredes.


Volviendo al direccionemineto privado:
_____________________________________

Problema: escasez de direcciones luego una solucion para ello sera el direccionamiento sin clase.
Como primera solucion proponemos el direccionamiento sin clase ya comentado.
Aumentando el repertorio definimos las direcciones privadas, a diferencia de las redes publicas que son únicas, las direcciones privadas solo serán únicas entre dispositivos de la misma isla, es decir, dos dispositivos tendran la misma direccion siempre uy cuando esten en distinta isla. En definitiva, no tengan conexion con el exterior.

En cada clase hay un rango:
    · Clase A:10.x.y.z
    · Clase B:172.16____31.y.z
    · Clase C:192.168.y.z
Estas redes no tienen conexion de red y usan la mascara que convenga en cada momento.

Al direccionar en direcciones privadas necesito algo mas que simplemente la direccion IP y es la traduccion de red, es decir, el NAT.

La intranet de una empresa es la parte de red que tiene direcciones privadas y solo los componentes de esa red se "conocen" en el caso contraro, si hay una parte de los dispositivos que usan direcciones publicas se llamara extranet porque si se relacionan con el exterior.
    
Veamos ahroa la traduccion de red, supongamos que tengo un PC(192.168.1.2) conectado al router(192.168.1.1-33.33.33.33) de nuestra casa conectado con otro dispositivo (66.66.66.66). Dividimos ahora el camino de un paqeute en 4 pasos:
    1.PC-router: Una peticion http esta dormada por un acabecera http y por datos. La cabecera contiene:
            - Direccion Ip origen(source):      192.168.1.2 + sport=1075 (asignado por el SO)
            .Direccion Ip destino(destination): 66.66.66.66 + dport=80 (puerto)


    Nota: Cuando uso un cliente, el sistema operativo asocia un numero por encima de 1024 para cualqueir nuevo proceso http.

    2.router-dispositivo: Se modifica el paquete ligeramente con las mismas partes:

        . Ip origen(source): 33.33.33.33 + sport=12345 se cambia para que el dispositivo de detino sepa a donde devolver, necesariamente tiene que ser publica(esto ocurre en ambos campos).
        · Ip destino: 66.66.66.66 + dport=80 que no cambia pues esta marcando el servidor

    El puerdo de origen debe cambiarse, no puedo distinguir una direccion Ip simpelmente por ello, solo conozco la red por l amascare luego tengo que cambiar el puerto, usar un puero que no se haya usado ya; por ejemplo 12345. Lo que busco es que cada puerto no se repita.

    3.disposityivo-router: EL serbvidfor no conoce que se esta haciendo NAT, los componentee son:

        · Ip origen: 66.66.66.66 + sport=80 (no hay problema pues no se sabe)
        ·Ip destino: 33.33.33.33 + dsort=12345(en este caso el puerto es el mismo)

    4.router-pc: llegamos la problema de traduccion, el router debe enviarlo al pc con componenetes:
        · Ip origen : 66.66.66.66 + sport=80
        ·Ip destino : 192.162.1.2 + dport =1075

Por ahora desconocemosc como se hace el cambio y es con una tabla. Cuando hago el cambio de orignen y vuelvo a origen ete procso se llama SNAT o SNAPT(la p de Port si cambiamos el puerto).

Para hacer eso, el router dispone de una tabla que esta construida de la siquiete manetea:

Ip source + sport | IP' source + sport' 

192.168.1.2 1075    33.33.33.33 12345

Se llama enmascaramiento porque el que esta fuera deconoce loq ue hay en la red de dentro

Veamos alguno de los problemas, un atacante podría mandar al un paquete a un router buscando un router que haya un rpotocolo snar, de esta manera se podría interoducir un paquete.
Como solucion, podemo  sporner la direccion de ip destino y el puerto de desino en la columna izquierda; estas dos infroamciones me determinan un flujo; esto hace que la ip del atacante y la original no sea la misma. Nos aseguramos de qu enadie que identeifique puertos haga maldades, leugo el router no manda el paquete malo hacia adentro.
Uno se llama NAT estricto y otro no compprueba qé ips le hablan a trabes de la red publica.

Veamos como funciona DNAT [(Destination NAP) no esta en las transparencias]
----------------------------------------------------------------------------
El caso tipo es tener un PC que actua como servidor en la red privada donde tenfo tamien uunrouter que me conecta a internet y dentro de internet tengo un equipo que actua comom cluebte.7

Sigueindo los mimso apsos;
        1.Tengo paquete con cabeceta IP y cabecera TCP (si es TCP) y sus datos. 
            Ip origen : Suponemos que es 66.66.66.66 + sport = 1050 (*SO)
            Ip destino: Será la publica del router para que pueda encaminar 33.33.33.33 + dport=23456 suponiendo que el server usa el puerto 80
        
        2. Tengo lo mismo pero en la cabecera ip hay cambios
            Ip origen: 66.66.66.66 + sport=1050
            Ip destino: Servidor privada 192.168.1.2 + dport=80

    Hemos traducido a un pueto de destino distinto pero en el inicio ha cambiado l aidreccion de destino como el pla direccion publica del router mas cercano

        Vuelta de camino
        3. Ip origen 192.168.1.2 + dport=80
           Ip destino 66.66.66.66 + dport=1050

        4. Llegando al ciente
            Ip origne 33.33.33.33 + sport=23456
            Ip destino 66.66.66.66 + dport = 1050

    Estoy deshaciendo el cambio que hice antes al principio pero ahora en sentido contrario.

Vamos a ver ahora la tabla necesaria:


Ip destino + dport -> Ip' destino + dport'
33.33.33.33+23456   |   192.168.1.2 + 80  <--- port forwarding (no llameis abrir un puerto[un cortafuegos deje pasar un paquete])

El problema viene sobre como decirle al router a que servidor va el paquete pues eso no esta en el propio paquete. Para solucionarlo debemo sfijar la rabla a mano en el router. SNAT permite generar la tabla automaticamente de ahi que suela venir por defecto.

****No hay problema en que haya varios servers en la parte privada conectados al mismo puerto siempre que tengan cad uno un puerto externo****

    ·IPV6 (esta en auge)
    
        Es otra de las soluciones que hay al agotamiento de direcciones IP, contiene 128 bits por red, usa el hexadecimal conel formato FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF obteniendo 340 sextillones

ENCAMINAMIENTO
--------------------------
Los proces que se hacen antes de encaminart reciben el nombre de preroutin y los de despues postroutin, DNAT es prerouting.

Basicamente el proceso consiste en dado un paquete mandado y que llega a un router ocmo pasarlo a otro destino cercano.




EJERCICIOS DE DIRECCIONAMIENTO
-------------------------------

Diap 30.

Donde hay un switch hay un cable por bverlo en nivel 3

Si pide direcciones publicas no desperdicio direcciones restringiendo lo maximo posbile

Debe determinar si los routers estan dentro del numero de dispositivos; sumar las redes de difusion y la de red.
